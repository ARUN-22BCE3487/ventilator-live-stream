<!DOCTYPE html>
<html>
<head>
  <title>Live Ventilator Monitor</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>

<h2>Live Ventilator Pressure</h2>
<canvas id="chart"></canvas>

<script>
const socket = io({
  reconnection: true,
  reconnectionAttempts: Infinity,
  reconnectionDelay: 1000
});

const ctx = document.getElementById("chart").getContext("2d");

const chart = new Chart(ctx, {
  type: "line",
  data: {
    labels: [],
    datasets: [{
      label: "Pressure (cmH₂O)",
      data: [],
      borderWidth: 2,
      tension: 0.4
    }]
  },
  options: {
    animation: false,
    scales: { y: { min: 0, max: 40 } }
  }
});

// ✅ Event name matches backend
socket.on("ventilatorData", (data) => {
  if (chart.data.labels.length > 20) {
    chart.data.labels.shift();
    chart.data.datasets[0].data.shift();
  }

  chart.data.labels.push(new Date(data.timestamp).toLocaleTimeString());
  chart.data.datasets[0].data.push(data.pressure);
  chart.update();
});
</script>

</body>
</html>


